{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 47cdc5f2267683540728","webpack:///./src/xhjsonapi.js","webpack:///external \"frisbee\""],"names":[],"mappings":"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","file":"xhjsonapi.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"frisbee\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"frisbee\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"XHJsonApi\"] = factory(require(\"frisbee\"));\n\telse\n\t\troot[\"XHJsonApi\"] = factory(root[\"frisbee\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 47cdc5f2267683540728\n **/","/**\n生成符合 jsonrpc 2.0 规范的 api，基于 frisbee\n\n@author zhangxhbeta\n*/\n'use strict';\n\nimport Frisbee from 'frisbee';\n\n// 自定义的rpc错误对象\nfunction RPCError(code, message) {\n  this.name = 'RPCError';\n  this.message = (message || '');\n  this.code = (code || -32603);\n}\nRPCError.prototype = new Error;\n\nexport default class XHJsonApi extends Frisbee{\n\n  constructor(opts) {\n    super(opts);\n\n    if (!this.opts.rpcPath) {\n      throw new Error('需要提供rpc路径参数（rpcPath）');\n    }\n\n    if (!this.opts.methods) {\n      throw new Error('需要提供方法定义列表（methods）');\n    }\n\n    this.opts.methods.forEach((namespace) => {\n      this[namespace.name] = namespace.methods.reduce((result, method) => {\n        // 依次设置方法函数\n        result[method] = (...params) => {\n          const payload = {\n            jsonrpc: '2.0',\n            method: `${namespace.remoteName || namespace.name}.${method}`,\n            id: 1,\n            params: params,\n          };\n\n          return this.post(this.opts.rpcPath, {credentials: 'include', body: JSON.stringify(payload)})\n            .then(({response, body}) => {\n              // 这里接收到 body 和 原始的 response\n              if (typeof body === 'object') {\n                const result = body.result;\n                const error = body.error;\n                if (result !== undefined) {\n                  // 成功返回结果\n                  return result;\n                } else if (error !== undefined) {\n                  if (typeof error === 'object' && error.code && error.message) {\n                    throw new RPCError(error.code, error.message);\n                  } else {\n                    throw new RPCError(-32700, '无法解析响应的错误信息');\n                  }\n                } else {\n                  throw new RPCError(-32700, '无法解析响应');\n                }\n              } else {\n                throw new RPCError(-32700, '无法解析响应');\n              }\n            });\n        };\n        return result;\n      }, {});\n    });\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/xhjsonapi.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"frisbee\"\n ** module id = 1\n ** module chunks = 0\n **/"],"sourceRoot":""}