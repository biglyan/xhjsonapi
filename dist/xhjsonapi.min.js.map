{"version":3,"sources":["xhjsonapi.min.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_1__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","constructor","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","value","enumerable","writable","configurable","setPrototypeOf","__proto__","RPCError","code","message","name","defineProperty","_frisbee","_frisbee2","Error","XHJsonApi","_Frisbee","opts","_this","getPrototypeOf","rpcPath","methods","forEach","namespace","reduce","result","method","_len","arguments","length","params","Array","_key","payload","jsonrpc","remoteName","post","credentials","body","JSON","stringify","then","_ref","response","_result","error","undefined"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,gBAAZC,UAA0C,gBAAXC,QACxCA,OAAOD,QAAUD,EAAQG,QAAQ,YACR,kBAAXC,SAAyBA,OAAOC,IAC9CD,QAAQ,WAAYJ,GACM,gBAAZC,SACdA,QAAmB,UAAID,EAAQG,QAAQ,YAEvCJ,EAAgB,UAAIC,EAAQD,EAAc,UACzCO,KAAM,SAASC,GAClB,MAAgB,UAAUC,GAKhB,QAASC,GAAoBC,GAG5B,GAAGC,EAAiBD,GACnB,MAAOC,GAAiBD,GAAUT,OAGnC,IAAIC,GAASS,EAAiBD,IAC7BT,WACAW,GAAIF,EACJG,QAAQ,EAUT,OANAL,GAAQE,GAAUI,KAAKZ,EAAOD,QAASC,EAAQA,EAAOD,QAASQ,GAG/DP,EAAOW,QAAS,EAGTX,EAAOD,QAvBf,GAAIU,KAqCJ,OATAF,GAAoBM,EAAIP,EAGxBC,EAAoBO,EAAIL,EAGxBF,EAAoBQ,EAAI,GAGjBR,EAAoB,KAK/B,SAASP,EAAQD,EAASQ,GAO/B,YAUA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAQH,GAAO,MAAOA,IAAyB,mBAAXI,SAA0BJ,EAAIK,cAAgBD,OAAS,eAAkBJ,GAEtH,QAASM,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAEhH,QAASC,GAA2BC,EAAMhB,GAAQ,IAAKgB,EAAQ,KAAM,IAAIC,gBAAe,4DAAgE,QAAOjB,GAAyB,gBAATA,IAAqC,kBAATA,GAA8BgB,EAAPhB,EAElO,QAASkB,GAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIN,WAAU,iEAAoEM,GAAeD,GAASE,UAAYC,OAAOC,OAAOH,GAAcA,EAAWC,WAAaX,aAAec,MAAOL,EAAUM,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeP,IAAYE,OAAOM,eAAiBN,OAAOM,eAAeT,EAAUC,GAAcD,EAASU,UAAYT,GAGje,QAASU,GAASC,EAAMC,GACtBxC,KAAKyC,KAAO,WACZzC,KAAKwC,QAAUA,GAAW,GAC1BxC,KAAKuC,KAAOA,GAAQ,OAtBtBT,OAAOY,eAAe/C,EAAS,cAC7BqC,OAAO,GAGT,IAAIW,GAAWxC,EAAoB,GAE/ByC,EAAYhC,EAAuB+B,EAkBvCL,GAAST,UAAY,GAAIgB,MAEzB,IAAIC,GAAY,SAAWC,GAGzB,QAASD,GAAUE,GACjB7B,EAAgBnB,KAAM8C,EAEtB,IAAIG,GAAQ1B,EAA2BvB,KAAM8B,OAAOoB,eAAeJ,GAAWtC,KAAKR,KAAMgD,GAEzF,KAAKC,EAAMD,KAAKG,QACd,KAAM,IAAIN,OAAM,uBAGlB,KAAKI,EAAMD,KAAKI,QACd,KAAM,IAAIP,OAAM,sBA8ClB,OA3CAI,GAAMD,KAAKI,QAAQC,QAAQ,SAAUC,GACnCL,EAAMK,EAAUb,MAAQa,EAAUF,QAAQG,OAAO,SAAUC,EAAQC,GAuCjE,MArCAD,GAAOC,GAAU,WACf,IAAK,GAAIC,GAAOC,UAAUC,OAAQC,EAASC,MAAMJ,GAAOK,EAAO,EAAUL,EAAPK,EAAaA,IAC7EF,EAAOE,GAAQJ,UAAUI,EAG3B,IAAIC,IACFC,QAAS,MACTR,QAASH,EAAUY,YAAcZ,EAAUb,MAAQ,IAAMgB,EACzDnD,GAAI,EACJuD,OAAQA,EAGV,OAAOZ,GAAMkB,KAAKlB,EAAMD,KAAKG,SAAWiB,YAAa,UAAWC,KAAMC,KAAKC,UAAUP,KAAYQ,KAAK,SAAUC,GAC9G,GACIJ,IADWI,EAAKC,SACTD,EAAKJ,KAGhB,IAAoE,YAA/C,mBAATA,GAAuB,YAAcrD,EAAQqD,IAAqB,CAC5E,GAAIM,GAAUN,EAAKb,OACfoB,EAAQP,EAAKO,KACjB,IAAgBC,SAAZF,EAEF,MAAOA,EACF,MAAcE,UAAVD,EAC6D,YAAhD,mBAAVA,GAAwB,YAAc5D,EAAQ4D,KAAwBA,EAAMrC,MAAQqC,EAAMpC,QAC9F,GAAIF,GAASsC,EAAMrC,KAAMqC,EAAMpC,SAE/B,GAAIF,GAAS,OAAQ,eAGvB,GAAIA,GAAS,OAAQ,UAG7B,KAAM,IAAIA,GAAS,OAAQ,aAI1BkB,SAGJP,EAGT,MA7DAvB,GAAUoB,EAAWC,GA6DdD,GACNF,EAAAA,WAEHjD,GAAAA,WAAkBmD,GAIb,SAASlD,EAAQD,GAEtBC,EAAOD,QAAUM","file":"xhjsonapi.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"frisbee\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"frisbee\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"XHJsonApi\"] = factory(require(\"frisbee\"));\n\telse\n\t\troot[\"XHJsonApi\"] = factory(root[\"frisbee\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/**\n\t生成符合 jsonrpc 2.0 规范的 api，基于 frisbee\n\t\n\t@author zhangxhbeta\n\t*/\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _frisbee = __webpack_require__(1);\n\t\n\tvar _frisbee2 = _interopRequireDefault(_frisbee);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _typeof(obj) { return obj && typeof Symbol !== \"undefined\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\t// 自定义的rpc错误对象\n\tfunction RPCError(code, message) {\n\t  this.name = 'RPCError';\n\t  this.message = message || '';\n\t  this.code = code || -32603;\n\t}\n\tRPCError.prototype = new Error();\n\t\n\tvar XHJsonApi = (function (_Frisbee) {\n\t  _inherits(XHJsonApi, _Frisbee);\n\t\n\t  function XHJsonApi(opts) {\n\t    _classCallCheck(this, XHJsonApi);\n\t\n\t    var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(XHJsonApi).call(this, opts));\n\t\n\t    if (!_this.opts.rpcPath) {\n\t      throw new Error('需要提供rpc路径参数（rpcPath）');\n\t    }\n\t\n\t    if (!_this.opts.methods) {\n\t      throw new Error('需要提供方法定义列表（methods）');\n\t    }\n\t\n\t    _this.opts.methods.forEach(function (namespace) {\n\t      _this[namespace.name] = namespace.methods.reduce(function (result, method) {\n\t        // 依次设置方法函数\n\t        result[method] = function () {\n\t          for (var _len = arguments.length, params = Array(_len), _key = 0; _key < _len; _key++) {\n\t            params[_key] = arguments[_key];\n\t          }\n\t\n\t          var payload = {\n\t            jsonrpc: '2.0',\n\t            method: (namespace.remoteName || namespace.name) + '.' + method,\n\t            id: 1,\n\t            params: params\n\t          };\n\t\n\t          return _this.post(_this.opts.rpcPath, { credentials: 'include', body: JSON.stringify(payload) }).then(function (_ref) {\n\t            var response = _ref.response;\n\t            var body = _ref.body;\n\t\n\t            // 这里接收到 body 和 原始的 response\n\t            if ((typeof body === 'undefined' ? 'undefined' : _typeof(body)) === 'object') {\n\t              var _result = body.result;\n\t              var error = body.error;\n\t              if (_result !== undefined) {\n\t                // 成功返回结果\n\t                return _result;\n\t              } else if (error !== undefined) {\n\t                if ((typeof error === 'undefined' ? 'undefined' : _typeof(error)) === 'object' && error.code && error.message) {\n\t                  throw new RPCError(error.code, error.message);\n\t                } else {\n\t                  throw new RPCError(-32700, '无法解析响应的错误信息');\n\t                }\n\t              } else {\n\t                throw new RPCError(-32700, '无法解析响应');\n\t              }\n\t            } else {\n\t              throw new RPCError(-32700, '无法解析响应');\n\t            }\n\t          });\n\t        };\n\t        return result;\n\t      }, {});\n\t    });\n\t    return _this;\n\t  }\n\t\n\t  return XHJsonApi;\n\t})(_frisbee2.default);\n\t\n\texports.default = XHJsonApi;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n/***/ }\n/******/ ])\n});\n;\n//# sourceMappingURL=xhjsonapi.js.map"],"sourceRoot":"/source/"}